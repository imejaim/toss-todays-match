# 🧪 사용자 시나리오 기반 검증 (User Scenario Verification)

## 📌 개요
이 문서는 사용자의 실제 행동 흐름(User Flow)을 기반으로 테스트 시나리오를 정의합니다.
새로운 기능 개발 시 반드시 이 시나리오를 기반으로 검증해야 합니다.

---

## 🎬 시나리오 1: 광고 보고 운명 이미지 만들기 (나/꿍친)

### 👤 사용자 행동
1. **[진입]** 홈 화면에서 '내 프로필' 또는 '꿍친 프로필' 클릭
2. **[탐색]** 프로필 수정 화면 하단의 "✨ 운명 이미지" 섹션으로 스크롤
3. **[액션]** "🎬 광고 보고 이미지 만들기" 버튼 클릭
4. **[광고]** (토스 앱) 전면 광고 시청 / (로컬) 로딩 후 자동 스킵
5. **[결과]** 광고 종료 후 아바타 이미지가 생성되어 화면에 표시됨
6. **[저장]** "저장하기" 버튼 클릭 후 홈 화면에 반영 확인

### ✅ 검증 포인트 (Checklist)
- [ ] **광고 트리거**: 버튼 클릭 시 `showRewardAd`가 호출되는가?
- [ ] **콜백 처리**: 광고 완료(`onRewarded`) 후 이미지 생성 로직이 실행되는가? (Promise 사용 금지)
- [ ] **UI 피드백**: 광고 로딩 중 버튼이 비활성화되거나 로딩 표시가 뜨는가?
- [ ] **데이터 저장**: 생성된 이미지가 `avatarUrl`에 저장되는가?
- [ ] **홈 화면 반영**: **(중요)** 프로필 저장 후 홈 화면의 "내 연애 프로필" 카드 아이콘이 원숭이/띠 이모지에서 생성된 이미지로 변경되었는가?

### 🚫 실패 사례 (Regression)
- **v1.0.3**: `await showRewardAd()` 형태로 잘못 호출하여 광고 후 아무 일도 안 일어남.
  → **해결**: `showRewardAd({ onRewarded: ... })` 콜백 형태로 구현 필수.

---

## 🎬 시나리오 2: 결과 공유하고 친구 초대하기

### 👤 사용자 행동
1. **[진입]** 프리미엄 리포트 또는 운세 상세 화면
2. **[액션]** "친구에게 공유하기" 또는 "공유" 버튼 클릭
3. **[복사]** "링크가 복사되었습니다" 메시지 확인 (또는 공유 시트 열림)
4. **[전송]** 카카오톡/메신저에 붙여넣기
5. **[확인]** 전송된 링크를 클릭하여 앱(또는 웹페이지)이 정상적으로 열리는지 확인

### ✅ 검증 포인트 (Checklist)
- [ ] **URL 유효성**: 공유된 링크가 `http/https`로 시작하는 유효한 URL인가?
- [ ] **404 방지**: 하드코딩된 가짜 URL(`toss.im/fake`)이 아닌 실제 `window.location.href` 또는 배포 URL인가?
- [ ] **딥링크**: 토스 앱 내에서 공유 시 올바른 스킴(`toss://` 등) 또는 웹 URL이 복사되는가?

---

## 🎬 시나리오 3: 프리미엄 리포트 잠금 해제

### 👤 사용자 행동
1. **[진입]** 오늘의 운세 확인 후 "프리미엄 리포트" 클릭
2. **[액션]** "광고 보고 무료로 확인" 버튼 클릭
3. **[광고]** 광고 시청 완료
4. **[결과]** 잠금 화면이 사라지고 상세 분석 내용 표시

### ✅ 검증 포인트 (Checklist)
- [ ] **브릿지 연동**: `useRewardedAd` 훅이 토스 브릿지(`@apps-in-toss/web-bridge`)를 사용해 광고를 로드하는가?
- [ ] **상태 관리**: 리포트 내용이 보이기 전까지 `isUnlocked` 상태가 정확히 관리되는가?

---

## 🛠️ QC 테스트 반영
위 시나리오의 핵심 로직은 `npm run qc`를 통해 자동 검증합니다.
- **광고**: 주석 제외 `showRewardAd({` 패턴 존재 여부 확인 (콜백 사용 강제)
- **공유**: `share.ts` 내 하드코딩된 `toss.im` 도메인 사용 경고
